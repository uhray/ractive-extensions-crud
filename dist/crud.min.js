define(["ractive","crud"],function(e,r){function t(e,r,t){var c;if(e.length)for(c=0;c<e.length;c++)r.call(t||this,e[c],c);else for(c in e)r.call(t||this,e[c],c)}function c(e,r,c){function u(e,r){a[this.idx]=r,e?(i=d.length,c(e,a)):++i==d&&c(null,a)}var i=0,d=e.length,a=[];t(e,function(e,t){a.push(null),setTimeout(r,0,e,u.bind({idx:t}))})}function u(e){var r="_fire"+e;return function(t,c){var u=this;t[r]=function(r,i,d){c({node:t,name:e,target:u,original:r,error:i,data:d})}}}var i;Ractive.events.crudUpdate=u("crudUpdate"),Ractive.events.crudUpdateSuccess=u("crudUpdateSuccess"),Ractive.events.crudUpdateFailure=u("crudUpdateFailure"),Ractive.events.crudDelete=u("crudDelete"),Ractive.events.crudDeleteSuccess=u("crudDeleteSuccess"),Ractive.events.crudDeleteFailure=u("crudDeleteFailure"),Ractive.events.crudCreate=u("crudCreate"),Ractive.events.crudCreateSuccess=u("crudCreateSuccess"),Ractive.events.crudCreateFailure=u("crudCreateFailure"),i=Ractive.extend({onrender:function(e){var t=this;this._super(e),this.on("crud-update",function(e,t,u){var i,d=r.configure();u||"string"==typeof t||(u=t,t=null),u=u||e.context,i=u instanceof Array?u:[u],c(i,function(e,c){var u=t;u?r(t,e[d.idGetter]).update(e,c):e._crud.update(e,c)},function(r,t){var c=e.node;c&&c._firecrudUpdate&&c._firecrudUpdate(e,r,t),r&&c&&c._firecrudUpdateFailure&&c._firecrudUpdateFailure(e,r,t),r||c&&c._firecrudUpdateSuccess&&c._firecrudUpdateSuccess(e,r,t)})}),this.on("crud-delete",function(e,c,u){function i(r,c){var u=e.node;u&&u._firecrudDelete&&u._firecrudDelete(e,r,c),r&&u&&u._firecrudDeleteFailure&&u._firecrudDeleteFailure(e,r,c),r||u&&u._firecrudDeleteSuccess&&u._firecrudDeleteSuccess(e,r,c),!r&&""!==n&&void 0!==n&&s&&t.splice(s,n,1)}var a=e.keypath.split("."),n=a.pop(),s=a.join("."),l=r.configure();c=c||e.context,u?r(u,d[l.idGetter]).del(i):c._crud.del(i)}),this.on("crud-create",function(e,r,t){(t||r._crud).create(obj||{},function(t,c){var u=e.node;u&&u._firecrudCreate&&u._firecrudCreate(e,t,c),t&&u&&u._firecrudCreateFailure&&u._firecrudCreateFailure(e,t,c),t||u&&u._firecrudCreateSuccess&&u._firecrudCreateSuccess(e,t,c),r.push(c)})})}}),Ractive.prototype=i.prototype});