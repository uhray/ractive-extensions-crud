define(["ractive","crud"],function(e,r){function t(e,r,t){var u;if(e.length)for(u=0;u<e.length;u++)r.call(t||this,e[u],u);else for(u in e)r.call(t||this,e[u],u)}function u(e,r,u){function c(e,r){n[this.idx]=r,e?(i=d.length,u(e,n)):++i==d&&u(null,n)}var i=0,d=e.length,n=[];t(e,function(e,t){n.push(null),setTimeout(r,0,e,c.bind({idx:t}))})}function c(e){var r="_fire"+e;return function(t,u){var c=this;t[r]=function(r,i,d){u({node:t,name:e,target:c,original:r,error:i,data:d})}}}var i;e.events.crudUpdate=c("crudUpdate"),e.events.crudUpdateSuccess=c("crudUpdateSuccess"),e.events.crudUpdateFailure=c("crudUpdateFailure"),e.events.crudDelete=c("crudDelete"),e.events.crudDeleteSuccess=c("crudDeleteSuccess"),e.events.crudDeleteFailure=c("crudDeleteFailure"),e.events.crudCreate=c("crudCreate"),e.events.crudCreateSuccess=c("crudCreateSuccess"),e.events.crudCreateFailure=c("crudCreateFailure"),i=e.extend({onrender:function(e){var t=this;this._super(e),this.on("crud-update",function(e,r){var t=r instanceof Array?r:[r];u(t,function(e,r){e._crud.update(e,r)},function(u,c){var i=e.node;t!=r&&(c=c[0]),i&&i._firecrudUpdate&&i._firecrudUpdate(e,u,c),u&&i&&i._firecrudUpdateFailure&&i._firecrudUpdateFailure(e,u,c),u||i&&i._firecrudUpdateSuccess&&i._firecrudUpdateSuccess(e,u,c)})}),this.on("crud-delete",function(e,r){var u=e.keypath.split("."),c=u.pop(),i=u.join(".");r._crud.del(function(r,u){var d=e.node;!r&&""!==c&&void 0!==c&&i&&t.splice(i,c,1),d&&d._firecrudDelete&&d._firecrudDelete(e,r,u),r&&d&&d._firecrudDeleteFailure&&d._firecrudDeleteFailure(e,r,u),r||d&&d._firecrudDeleteSuccess&&d._firecrudDeleteSuccess(e,r,u)})}),this.on("crud-create",function(e,t,u){var c;t instanceof Array?c=t._crud:(c=r(t),t=[]),c.create(u||{},function(r,u){var c=e.node;!r&&u&&t.push(u),c&&c._firecrudCreate&&c._firecrudCreate(e,r,u),r&&c&&c._firecrudCreateFailure&&c._firecrudCreateFailure(e,r,u),r||c&&c._firecrudCreateSuccess&&c._firecrudCreateSuccess(e,r,u)})})}}),e.prototype=i.prototype});