define(["ractive","crud"],function(e){function r(e,r,t){var u;if(e.length)for(u=0;u<e.length;u++)r.call(t||this,e[u],u);else for(u in e)r.call(t||this,e[u],u)}function t(e,t,u){function c(e,r){n[this.idx]=r,e?(d=i.length,u(e,n)):++d==i&&u(null,n)}var d=0,i=e.length,n=[];r(e,function(e,r){n.push(null),setTimeout(t,0,e,c.bind({idx:r}))})}function u(e){var r="_fire"+e;return function(t,u){var c=this;t[r]=function(r,d,i){u({node:t,name:e,target:c,original:r,error:d,data:i})}}}var c;e.events.crudUpdate=u("crudUpdate"),e.events.crudUpdateSuccess=u("crudUpdateSuccess"),e.events.crudUpdateFailure=u("crudUpdateFailure"),e.events.crudDelete=u("crudDelete"),e.events.crudDeleteSuccess=u("crudDeleteSuccess"),e.events.crudDeleteFailure=u("crudDeleteFailure"),e.events.crudCreate=u("crudCreate"),e.events.crudCreateSuccess=u("crudCreateSuccess"),e.events.crudCreateFailure=u("crudCreateFailure"),c=e.extend({onrender:function(e){var r=this;this._super(e),this.on("crud-update",function(e,r){var u=r instanceof Array?r:[r];t(u,function(e,r){e._crud.update(e,r)},function(t,c){var d=e.node;u!=r&&(c=c[0]),d&&d._firecrudUpdate&&d._firecrudUpdate(e,t,c),t&&d&&d._firecrudUpdateFailure&&d._firecrudUpdateFailure(e,t,c),t||d&&d._firecrudUpdateSuccess&&d._firecrudUpdateSuccess(e,t,c)})}),this.on("crud-delete",function(e,t){var u=e.keypath.split("."),c=u.pop(),d=u.join(".");t._crud.del(function(t,u){var i=e.node;i&&i._firecrudDelete&&i._firecrudDelete(e,t,u),t&&i&&i._firecrudDeleteFailure&&i._firecrudDeleteFailure(e,t,u),t||i&&i._firecrudDeleteSuccess&&i._firecrudDeleteSuccess(e,t,u),!t&&""!==c&&void 0!==c&&d&&r.splice(d,c,1)})}),this.on("crud-create",function(e,r,t){r._crud.create(t||{},function(t,u){var c=e.node;c&&c._firecrudCreate&&c._firecrudCreate(e,t,u),t&&c&&c._firecrudCreateFailure&&c._firecrudCreateFailure(e,t,u),t||c&&c._firecrudCreateSuccess&&c._firecrudCreateSuccess(e,t,u),r.push(u)})})}}),e.prototype=c.prototype});